<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--客户映射 指定到dao接口 -->
<mapper namespace="com.park.ssm.dao.AccountDao">


<resultMap type="Account" id="accountRoughResult">
	<id property="id" column="id"/>
	<result property="userId" column="userId"/>
	<result property="parkingLotId" column="parkingLotId"/>
	<result property="parkingPositionId" column="parkingPositionId"/>
	<result property="cardId" column="cardId"/>
	<result property="state" column="state" typeHandler="com.park.ssm.entity.type.AccountStateHandler"/>
	<association property="currentBill"  column="currentBillId" fetchType="eager" 
		select="selectInfoById" autoMapping="true" />
		
	<collection property="bills" column="id" fetchType="lazy" 
		select="selectBillInfoByAccountId" autoMapping="true" />
</resultMap>

<!-- 加载Bill信息 -->
<select id="selectBillInfoById" parameterType="Long">
	select * from Bill
	where id=#{_parameter}
</select>
<select id="selectBillInfoByAccountId" parameterType="Long">
	select * from Bill
	where accountId=#{_parameter}
</select>


<!-- dao相关sql -->
<sql id="sqlField">
	id,userId,parkingLotId,parkingPositionId,cardId,state,currentBillId
</sql>


<select id="loadAccountById" parameterType="long" resultMap="accountRoughResult">
	select 
		*
	from Account
	where id=#{_parameter}
</select>
<select id="loadAccountByIdForUpdate" parameterType="long" resultMap="accountRoughResult">
	select 
		*
	from Account
	where id=#{_parameter}
	for update
</select>

<insert id="insertAccount" parameterType="Account">
insert into Account (id,userId,parkingLotId,parkingPositionId,cardId,state,currentBillId) values
(#{id},#{userId},#{parkingLotId},#{parkingPositionId},#{cardId},${state.getInd()},#{currentBillId})
</insert>

<update id="setAccountState">
update Account
	set state=${state.getInd()}
where id=#{id}
</update>

</mapper>
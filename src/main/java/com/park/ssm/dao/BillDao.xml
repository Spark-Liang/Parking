<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--客户映射 指定到dao接口 -->
<mapper namespace="com.park.ssm.dao.BillDao">


	<sql id="sqlField">
		id,userId,parkingLotId,accountId,price,billStartDate,billEndDate,isPaid
	</sql>

	<!-- 通过id加载账单 -->
	<select id="loadBillById" parameterType="Long" resultType="Bill">
		select
		<include refid="sqlField" />
		from Bill
		where id=#{_parameter}
	</select>
	<select id="loadBillByIdForUpdate" parameterType="Long"
		resultType="Bill">
		select
		<include refid="sqlField" />
		from Bill
		where id=#{_parameter}
		for update
	</select>

	<!-- 通过各種id組合加载账单 -->
	<select id="listBillById"  resultType="Bill">
		select
		<include refid="sqlField" />
		from Bill
		<where>
			<if test="userId != null">
				and userId=#{userId}
			</if>
			<if test="accountId != null">
				and accountId=#{accountId}
			</if>
			<if test="parkingLotId != null">
				and parkingLotId=#{parkingLotId}
			</if>
		</where>
		<if test="pageNum != null and pageSize != null">
			limit ${(pageNum-1)*pageSize},#{pageSize}
		</if>
	</select>
	<select id="countBillById" parameterType="Long" resultType="Integer">
		select
		 count(1)
		from Bill
		<where>
			<if test="userId != null">
				and user=#{userId}
			</if>
			<if test="accountId != null">
				and accountId=#{accountId}
			</if>
			<if test="parkingLotId != null">
				and parkingLotId=#{parkingLotId}
			</if>
		</where>
	</select>

	<update id="updateBillStateById">
		update Bill
		set isPaid=1
		where id=#{_parameter}
	</update>

    <select id="isNotPayBill" parameterType="Long" resultType="Integer">
    select count(id) from Bill
    <where>
    <if test="userId != null">
				and user=#{userId}
			</if>
    </where>
    </select>
</mapper>